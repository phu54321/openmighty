!function(e){function n(t){if(a[t])return a[t].exports;var r=a[t]={exports:{},id:t,loaded:!1};return e[t].call(r.exports,r,r.exports,n),r.loaded=!0,r.exports}var a={};return n.m=e,n.c=a,n.p="",n(0)}([function(e,n,a){"use strict";a(1),a(2),a(3),$(function(){$("#jokerCall").modal("open")}),$(document).on("click","#toast-container .toast",function(){$(this).fadeOut(function(){$(this).remove()})});var t=0;$(document).bind("touchstart",function(e){var n=+new Date;t+500>n&&e.preventDefault(),t=n})},function(e,n){"use strict";function a(e){return!0}function t(e){return""!==e}function r(e,n,t,r){var o=$("#"+n),d={};if(!o)return console.log("Unknown form '"+n+"'"),!1;for(var s=0;s<t.length;s++){var c=i(t[s],4),l=c[0],u=c[1],f=c[2],p=c[3];if(f||(f=a),p||(p="허용되지 않은 입력입니다."),d[u]=o.find("#"+l).val(),!f(d[u]))return window.alert(p),!1}return o.find("input, textarea").prop("disabled",!0),$.ajax({type:"POST",url:e,data:d,dataType:"json",success:function(e){e.error?(o.find("input, textarea").prop("disabled",!1),window.alert(e.error)):r(e)},error:function(e,n,a){console.log(n,"message : "+e.responseText+"\nerror : "+a)}}),!0}var i=function(){function e(e,n){var a=[],t=!0,r=!1,i=void 0;try{for(var o,d=e[Symbol.iterator]();!(t=(o=d.next()).done)&&(a.push(o.value),!n||a.length!==n);t=!0);}catch(e){r=!0,i=e}finally{try{!t&&d.return&&d.return()}finally{if(r)throw i}}return a}return function(n,a){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();window.issueRegister=function(){r("/users/register","registerForm",[["username","username",t,"이름을 입력하세요."],["useridf","useridf",a,""]],function(){window.location.reload(!0)})},window.issueLogout=function(){$.ajax({type:"POST",url:"/users/logout",success:function(e){window.location.reload(!0)},error:function(e,n,a){console.log(n,"message : "+e.responseText+"\nerror : "+a)}})}},function(e,n){"use strict";$(function(){function e(e){for(var n="",a="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",t=0;t<e;t++)n+=a.charAt(Math.floor(Math.random()*a.length));return n}$("#roomURL").attr("pattern","^"+location.origin+"/[a-zA-Z0-9]{8}|$"),$("#joinRoom").submit(function(n){var a=$("#roomURL"),t=a.val();if(""===t){var r=e(8);t=window.location.origin+"/"+r,a.val(t)}window.location.href=t,n.preventDefault()})})},function(e,n,a){"use strict";function t(){s=i(),s.on("err",function(e){r.toast(e,3e3)}),s.on("info",function(e){}),s.on("cmd",function(e){o.translateCmdMessage(e)}),s.on("reconnect",function(){}),s.on("disconnect",function(){})}var r=window.Materialize,i=window.io,o=a(4),d=a(12),s=void 0,c=$("#gameDiv");0!==c.length&&c.ready(function(){r.toast("로딩중",1500),d(t)}),n.sendCmd=function(e,n){var a=Object.assign({},n||{});return a.type=e,s.emit("cmd",a),!0},window.sendCmd=n.sendCmd},function(e,n,a){"use strict";var t={},r=window.Materialize,i=(a(5),a(7));n.translateCmdMessage=function(e){t[e.type]?t[e.type](e):r.toast("Unknown command message type : "+e.type,4e3)},a(8)(t),a(9)(t),a(10)(t),a(11)(t),t.gabort=function(e){var n=e.msg||"게임이 중간에 종료되었습니다.";r.toast(n,3e3),i.playing=!1,i.viewRoom(),$("#title").text("openMighty")}},function(e,n,a){"use strict";var t={},r=a(6);n=e.exports=t,n.viewDeck=function(){var e=$("#gameDiv .deck");e.empty();for(var n=0;n<t.deck.length;n++){var a=t.deck[n],i=[a.shape,a.num],o=i[0],d=i[1],s=r(null,"deck-card"),c=o[0]+d;s.find(".game-card").attr("card",c).addClass("game-card-"+c).addClass("game-card-shape-"+o[0]),e.append(s)}},n.shapeAbbrTable={spade:"♠",heart:"♥",diamond:"♦",clover:"♣",none:"N"},n.shapeStringTable={spade:"스페이드",heart:"하트",diamond:"다이아몬드",clover:"클로버",none:"노기루다"}},function(e,n){"use strict";var a=function(){function e(e,n){var a=[],t=!0,r=!1,i=void 0;try{for(var o,d=e[Symbol.iterator]();!(t=(o=d.next()).done)&&(a.push(o.value),!n||a.length!==n);t=!0);}catch(e){r=!0,i=e}finally{try{!t&&d.return&&d.return()}finally{if(r)throw i}}return a}return function(n,a){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),t=window.Materialize,r=["text","val","submit","click","remove","empty","addClass","removeClass"," toggleClass"],i=["disabled"],o=void 0;$(function(){o=$("#game-template"),o.detach()}),e.exports=function(e,n,d){function s(e){var n=a(e,2),t=n[0],o=n[1];r.indexOf(t)!=-1?l[t](o):i.indexOf(t)!=-1?l.prop(t,o):l.attr(t,o)}var c=o.find("#template-"+n).clone().removeAttr("id"),l=void 0;if(d)for(var u=0;u<d.length;u++){var f=a(d[u],2),p=f[0],m=f[1];l=p?c.find(p):c,1==l.length?Array.isArray(m[0])?m.forEach(s):(null!==m&&"string"!=typeof m||(m=[d[u][1],d[u][2]]),s(m)):(t.toast("Invalid selector : "+p,4e3),console.log("Invalid selector",d[u]))}return e&&(e.empty(),e.append(c)),c},e.exports.getTemplate=function(e){return o.find("#template-"+e)}},function(e,n,a){"use strict";function t(){var e=$(".player-self").find(".game-card-container");d(e,"button").focus(),e.find("button").click(function(e){o.sendCmd("start"),$(".player-has").empty(),e.preventDefault()})}var r=a(5),i={playing:!1,myidf:null,owner:0,users:[]},o=a(3),d=a(6);n=e.exports=i,n.viewRoom=function(){var e=void 0,n=void 0,a=void 0;i.playing?(n=-1,e=r.gameUsers,a=r.president):(n=i.owner,e=i.users,a=-1);var o=$(".player-slot");o.removeClass("player-empty player-owner player-president player-self player-ai player-leading");var d=null;o.find(".player-has").empty(),$(".last-trick").empty();for(var s=0;s<e.length;s++){var c=$(o[s]),l=e[s];c.find(".player-name").text(l.username),c.find(".game-card-container").empty(),n===s&&c.addClass("player-owner"),a===s&&c.addClass("player-president"),l.useridf==i.myidf&&(c.addClass("player-self"),d=s),l.ai&&c.addClass("player-ai")}for(var u=e.length;u<5;u++){var f=$(o[u]);f.addClass("player-empty"),f.find(".player-name").text("Empty"),f.find(".game-card-container").empty()}i.playing?r.selfIndex=d:n===d&&t()}},function(e,n,a){"use strict";var t=a(7),r=a(5),i=window.Materialize;e.exports=function(e){e.rjoin=function(e){i.toast(e.username+"님이 입장하셨습니다.",2e3),t.users.push({username:e.username,useridf:e.useridf}),t.viewRoom()},e.rleft=function(e){for(var n=t.users,a=0;a<n.length;a++){var o=n[a];if(o.useridf==e.useridf){t.playing?i.toast(o.username+"님이 탈주하셨습니다.",2e3):i.toast(o.username+"님이 퇴장하셨습니다.",2e3),n.splice(a,1);break}}if(t.owner=e.owner,t.playing){for(var d=r.gameUsers,s=0;s<d.length;s++)if(d[s].useridf==e.useridf){$($(".player-slot")[s]).addClass("player-ai");break}}else t.viewRoom()},e.rusers=function(e){t.owner=e.owner,t.users=e.users,t.myidf=e.youridf,t.viewRoom()}}},function(e,n,a){"use strict";var t=window.Materialize,r=a(6),i=a(5),o=a(7),d=a(3);e.exports=function(e){function n(e){if(!e.canDealMiss)return!1;var n=e.deck,a=0;return n.forEach(function(e){"spade"==e.shape&&14==e.num?a-=1:10==e.num?a+=.5:e.num>=11&&(a+=1)}),a<=1}e.gusers=function(e){i.gameUsers=e.users,i.president=-1,i.remainingBidder=5,i.lastBidder=null,i.bidCount=null,i.bidShape=null,i.canDealMiss=!0,o.playing=!0,o.viewRoom()},e.deck=function(e){i.deck=e.deck,i.viewDeck()},e.pbinfo=function(e){var n=$($(".player-slot .game-card-container")[e.bidder]);e.bidder==i.selfIndex&&(i.canDealMiss=!1),"pass"!=e.bidShape&&(i.bidShape=e.bidShape,i.bidCount=e.bidCount,i.lastBidder=e.bidder),n.find(".game-card").remove();var a=$("<div/>").addClass("game-card player-card-bidding");"pass"==e.bidShape?(a.text("pass"),i.remainingBidder--):a.text(e.bidShape+" "+e.bidCount),n.append(a),1==i.remainingBidder&&null!==i.lastBidder&&(i.lastBidder!=i.selfIndex&&t.toast("공약이 끝났습니다. 기다려주세요",1500),i.president=i.lastBidder)},e.bidrq=function(){var e=i.bidCount||13;"none"==i.bidShape&&e++;var a=$(".player-self .game-card-container"),t=r(a,"bidding");n(i)&&t.find("select[name=bidShape]").prepend($("<option/>").text("딜미스").val("dealmiss")).val("dealmiss"),t.attr("id","bidForm"),t.find('input[name="bidCount"]').attr("min",e).val(e),t.submit(function(){var e=$("#bidForm"),n=e.find('*[name="bidShape"]').val(),a=e.find('*[name="bidCount"]').val();return d.sendCmd("bid",{shape:n,num:parseInt(a)}),!1})},e.bc1rq=function(){t.toast("공약을 수정해주세요.",1500);var e=i.bidShape,n=i.bidCount,a=$(".player-self .game-card-container");r(a,"bidding",[[null,["id","bidChangeForm"]],[".player-form-title",["text","현재 : "+i.shapeAbbrTable[e]+n]],['input[name="bidCount"]',[["min",n],["val",n]]],['option[value="'+e+'"]',["remove"]],['option[value="pass"]',[["val",e],["text","그대로 ("+i.shapeStringTable[e]+")"]]],[null,["submit",function(){var e=$("#bidChangeForm"),n=e.find('*[name="bidShape"]').val(),a=e.find('*[name="bidCount"]').val();return n==i.bidShape&&a==i.bidCount&&(n="pass"),d.sendCmd("bc1",{shape:n,num:parseInt(a)}),!1}]]]).focus()},e.binfo=function(e){$(".player-slot .game-card-container").empty();var n=i.shapeStringTable[e.shape]+" "+e.num;t.toast("공약 : "+n,1500),$("#title").text("openMighty - "+n),i.bidShape=e.shape,i.bidCount=e.num,i.president=e.president,$($(".player-slot")[i.president]).addClass("player-leading player-president")}}},function(e,n,a){"use strict";var t=window.Materialize,r=window._,i=a(6),o=(a(7),a(5)),d=a(3),s=a(11);e.exports=function(e){function n(e){return{mighty:{shape:"spade"==e?"diamond":"spade",num:14},joker:{shape:"joker",num:0},girudaA:{shape:e,num:14},girudaK:{shape:e,num:13}}}function a(e,a,t){var r=n(e);if(r[a]){var i=r[a];return t.ftype="card",t.shape=i.shape,t.num=i.num,!0}return"first"==a?(t.ftype="first",!0):"none"==a&&(t.ftype="none",!0)}function c(e,a){var t=n(e);if("card"==a.ftype){var i=null;return r.keys(t).some(function(e){var n=t[e];if(n.shape==a.args.shape&&n.num==a.args.num)return i=e,!0}),i}return"first"==a.ftype?"first":"none"==a.ftype?"none":null}e.fsrq=function(){t.toast("카드 3장을 버리고 프렌드를 선정하세요",1500),$(".deck-card").click(function(){$(this).toggleClass("deck-card-selected")});var e=o.bidCount,n=o.bidShape,r=$(".player-self .game-card-container"),s=i(r,"fselect",[[null,["id","friendSelectForm"]],["option[value="+n+"]",["remove"]],['input[name="bidCount"]',[["min",e],["val",e]]],['option[value="pass"]',["val",n]]]);s.submit(function(){for(var e={},n=$("#friendSelectForm"),r=$("#gameDiv .deck .deck-card").toArray(),i=[],s=0;s<r.length;s++)$(r[s]).hasClass("deck-card-selected")&&i.push(s);if(3!=i.length)return t.toast("3장을 골라주세요.",1500),!1;e.discards=i;var c=n.find('*[name="bidShape"]').val(),l=n.find('*[name="bidCount"]').val();c==o.bidShape&&l==o.bidCount||(e.bidch2={shape:c,num:parseInt(l)});var u=n.find("select[name=friendType]").val();return a(c,u,e)?(d.sendCmd("fs",e),!1):(t.toast("프렌드를 선정해주세요.",1500),!1)})},e.fs=function(e){var n=c(o.bidShape,e);console.log(n);var a=i.getTemplate("fselect").find('option[value="'+n+'"]').text()+" 프렌드";t.toast(a,2e3),o.ftype=e.ftype,o.fargs=e.args;var r=$("#title");r.text(r.text()+" - "+a),s.initGame()}}},function(e,n,a){"use strict";function t(){r(),c.trick++}function r(){$("#gameDiv .deck-card").removeClass("deck-card-selected").unbind("click")}function i(){c.trick=0,c.starter=c.president,t()}function o(e){var n=e.attr("card"),a={s:"spade",h:"heart",c:"clover",d:"diamond",j:"joker"}[n[0]],t=parseInt(n.substr(1));return{shape:a,num:t}}var d=window.Materialize,s=a(6),c=a(5),l=a(7),u=a(3);n=e.exports=function(e){function n(e){$(".deck-card").addClass("deck-card-selectable")}function a(e){if("joker"==e.shape)return $("<div/>").addClass("has-slot has-joker").text("Joker");var n=["2","3","4","5","6","7","8","9","10","J","Q","K","A"][e.num-2];return $("<div/>").addClass("has-slot").addClass("has-"+e.shape).text(n)}e.cprq=function(e){d.toast("카드를 내주세요.",1500);var a=$(".player-self .game-card-container");s(a,"button",[["button",[["text","카드 내기"],["disabled",!0]]]]),n(e);var t=$(".deck-card-selectable");t.click(function(){$(".deck-card").removeClass("deck-card-selected"),$(this).addClass("deck-card-selected"),a.find("button").prop("disabled",!1)}),t.dblclick(function(){a.find("button").click()}),a.find("button").click(function(){var e=$(".deck-card-selected");1!=e.length&&d.toast("카드를 선택해주세요.",1500);var n=o(e.find(".game-card"));if(1!=c.trick&&3==n.num&&c.starter==c.selfIndex&&("clover"==c.bidShape&&"spade"==n.shape||"clover"!=c.bidShape&&"clover"==n.shape)){var a=$("#jokerCallModal");a.find("button[name=no]").click(function(){u.sendCmd("cp",{cardIdx:e.index(".deck-card")})}),a.find("button[name=yes]").click(function(){u.sendCmd("cp",{cardIdx:e.index(".deck-card"),jcall:!0})}),a.modal({dismissible:!1}),a.modal("open")}else"joker"==n.shape&&c.starter==c.selfIndex?!function(){var n=$("#jokerModal"),a=n.find("select[name=srq]");a.val("none"),n.modal({dismissible:!1}),n.find("button").click(function(){var n=a.val();"none"==n&&(n=void 0),u.sendCmd("cp",{cardIdx:e.index(".deck-card"),srq:n})}),n.modal("open")}():u.sendCmd("cp",{cardIdx:e.index(".deck-card")})})},e.jrq=function(e){var n=e.shaperq;d.toast("조커로 "+c.shapeStringTable[n]+"를 불렀습니다.",2e3)},e.pcp=function(e){var n=e.card,a=$($(".player-slot")[e.player]);"card"==c.ftype&&c.fargs.shape==n.shape&&c.fargs.num==n.num&&a.addClass("player-leading");var t=a.find(".game-card-container"),i=n.shape[0]+n.num;s(t,"game-card",[[null,[["addClass","game-card-"+i],["card",i]]]]),r()},e.tend=function(e){var n=$($(".player-has")[e.winner]),r=$(".player-slot .game-card"),i=$(".last-trick");i.empty(),r.each(function(){var e=o($(this));i.append(a(e)),e.num>=10&&n.append(a(e))}),"first"==c.ftype&&c.president!=e.winner&&2!=$(".player-leading").length&&c.trick<=4&&$($(".player-slot")[e.winner]).addClass("player-leading"),r.fadeOut(1e3),c.starter=e.winner,t()},e.gend=function(e){var n=c.bidCount,a=20-e.oppcc,t=void 0;e.setUser?!function(){t=$("#gameEndWithSetModal"),t.find(".set").text("게임 결과 - 셋 ("+c.gameUsers[e.setUser].username+")");var n=t.find(".deck");n.empty(),e.setDeck.forEach(function(e){var a=[e.shape,e.num],t=a[0],r=a[1],i=s(null,"deck-card"),o=t[0]+r;i.find(".game-card").attr("card",o).addClass("game-card-"+o).addClass("game-card-shape-"+t[0]),n.append(i)})}():t=$("#gameEndModal");var r=t.find(".modal-content p.score");a>=n?r.text("["+a+"/"+n+"] 여당 승리입니다."):r.text("["+a+"/"+n+"] 야당 승리입니다."),l.playing=!1,t.modal({dismissible:!0,complete:function(){l.playing||(l.viewRoom(),$("#title").text("openMighty"))}}),t.modal("open")}},n.issueTrickStart=t,n.initGame=i},function(e,n){"use strict";var a=function(){function e(e,n){var a=[],t=!0,r=!1,i=void 0;try{for(var o,d=e[Symbol.iterator]();!(t=(o=d.next()).done)&&(a.push(o.value),!n||a.length!==n);t=!0);}catch(e){r=!0,i=e}finally{try{!t&&d.return&&d.return()}finally{if(r)throw i}}return a}return function(n,a){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.exports=function(e){function n(){var n=129,i=185,o=document.createElement("canvas");o.width=n,o.height=i;var d=o.getContext("2d"),s=[];r.forEach(function(e){var r=a(e,3),c=r[0],l=r[1],u=r[2];d.drawImage(t,l,u,n,i,0,0,n,i);var f=o.toDataURL();s.push(".game-card-"+c+" {  background-image: url("+f+");}")}),$("<style>").prop("type","text/css").html(s.join("")).appendTo("head"),e&&e()}var t=new Image;t.onload=n,t.src="/images/cards/sprite.png";var r=[["c10",129,0],["c11",774,370],["c12",258,0],["c13",0,185],["c14",129,185],["c2",258,185],["c3",387,0],["c4",387,185],["c5",516,0],["c6",516,185],["c7",0,370],["c8",129,370],["c9",258,370],["d10",387,370],["d11",516,370],["d12",645,0],["d13",645,185],["d14",645,370],["d2",0,555],["d3",129,555],["d4",258,555],["d5",387,555],["d6",516,555],["d7",645,555],["d8",774,0],["d9",774,185],["h10",0,0],["h11",774,555],["h12",903,0],["h13",903,185],["h14",903,370],["h2",903,555],["h3",0,740],["h4",129,740],["h5",258,740],["h6",387,740],["h7",516,740],["h8",645,740],["h9",774,740],["j0",903,740],["s10",1032,0],["s11",1032,185],["s12",1032,370],["s13",1032,555],["s14",1032,740],["s2",0,925],["s3",129,925],["s4",258,925],["s5",387,925],["s6",516,925],["s7",645,925],["s8",774,925],["s9",903,925]]}}]);